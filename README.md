# Trinity ‚Äî –î–æ—Å–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω

–ú–æ–Ω–æ—Ä–µ–ø–æ: EmployerBot (—Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–∏) + WorkerBot (—Ä–∞–±–æ—Ç–Ω–∏–∫–∏). –û–¥–∏–Ω backend, –¥–≤–∞ –±–æ—Ç–∞, –µ–¥–∏–Ω–∞—è –ë–î.

## –°—Ç–µ–∫

- Node.js 20+
- TypeScript
- Telegraf
- PostgreSQL + Prisma

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îî‚îÄ‚îÄ db/              # Prisma schema, –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îî‚îÄ‚îÄ employer-bot/    # Backend: EmployerBot + WorkerBot
‚îÇ       ‚îî‚îÄ‚îÄ src/
‚îÇ           ‚îú‚îÄ‚îÄ bot.ts           # EmployerBot
‚îÇ           ‚îú‚îÄ‚îÄ worker.bot.ts    # WorkerBot
‚îÇ           ‚îú‚îÄ‚îÄ broadcastService.ts
‚îÇ           ‚îî‚îÄ‚îÄ scenes/
‚îî‚îÄ‚îÄ docker-compose.yml
```

## –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

### 1. PostgreSQL

```bash
docker compose up -d postgres
```

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env
# –ó–∞–ø–æ–ª–Ω–∏—Ç–µ BOT_TOKEN_EMPLOYER, BOT_TOKEN_WORKER, DATABASE_URL
```

### 3. –ú–∏–≥—Ä–∞—Ü–∏–∏

```bash
pnpm install
pnpm db:migrate
```

### 4. Backend (–æ–±–∞ –±–æ—Ç–∞)

```bash
pnpm employer:dev
```

## –î–µ–ø–ª–æ–π –Ω–∞ Render

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Background Worker** (–Ω–µ Web Service). –ü–æ–¥—Ä–æ–±–Ω–æ: [RENDER.md](RENDER.md).

## –î–µ–ø–ª–æ–π –Ω–∞ VPS (pm2)

```bash
pnpm install
pnpm db:migrate
pnpm employer:build

pm2 start apps/employer-bot/dist/index.js --name trinity-backend
pm2 save
pm2 startup
```

## EmployerBot ‚Äî —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

- **/start** ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö, –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- **–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É** ‚Äî wizard: –ø—Ä–æ—Ñ–µ—Å—Å–∏—è ‚Üí –¥–∞—Ç–∞ ‚Üí –≤—Ä–µ–º—è ‚Üí –º–µ—Å—Ç–æ ‚Üí –æ–ø–ª–∞—Ç–∞ ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- **–ú–æ–∏ –∑–∞—è–≤–∫–∏** ‚Äî —Å–ø–∏—Å–æ–∫ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π, –∫–Ω–æ–ø–∫–∏: –ó–∞–∫—Ä—ã—Ç—å, –£–¥–∞–ª–∏—Ç—å, –ü–æ–≤—Ç–æ—Ä–∏—Ç—å
- **–ü–æ–º–æ—â—å** ‚Äî –∫—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## WorkerBot ‚Äî —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

- **/start** ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, —Å–æ–≥–ª–∞—Å–∏–µ, –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- **üìù –ê–Ω–∫–µ—Ç–∞** ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏, –≥–æ—Ä–æ–¥, —Ä–∞–π–æ–Ω, –º–∏–Ω. —Å—Ç–∞–≤–∫–∞
- **‚öôÔ∏è –§–∏–ª—å—Ç—Ä—ã** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –ê–Ω–∫–µ—Ç—É
- **‚è∏ –ü–∞—É–∑–∞** ‚Äî –æ—Ç–∫–ª—é—á–∏—Ç—å/–≤–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **‚ùì –ü–æ–º–æ—â—å** ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- –†–∞—Å—Å—ã–ª–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π –ø–æ matching (–ø—Ä–æ—Ñ–µ—Å—Å–∏—è, –≥–æ—Ä–æ–¥, —Å—Ç–∞–≤–∫–∞)
- –ö–Ω–æ–ø–∫–∏: [‚úÖ –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è] `job:apply:<jobId>`, [üö´ –°–∫—Ä—ã—Ç—å] `job:hide:<jobId>`

## –ü—Ä–∏–º–µ—Ä –∫–∞—Ä—Ç–æ—á–∫–∏ –∑–∞—è–≤–∫–∏

```
üìã –ó–∞—è–≤–∫–∞ #clxxx...
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üë∑ –ü—Ä–æ—Ñ–µ—Å—Å–∏—è: –ì—Ä—É–∑—á–∏–∫
üìÖ –î–∞—Ç–∞: 15.03.2025
üïê –í—Ä–µ–º—è: 14:30
üìç –ú–µ—Å—Ç–æ: –Æ–Ω—É—Å–∞–±–∞–¥, —Ä—ã–Ω–æ–∫
üí∞ –û–ø–ª–∞—Ç–∞: 25 000 UZS/—á–∞—Å
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
```

## Callback_data

**EmployerBot:**
- `consent` ‚Äî —Å–æ–≥–ª–∞—Å–∏–µ
- `prof:–ì—Ä—É–∑—á–∏–∫`, `prof:other` ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏—è
- `wizard_cancel`, `wizard_publish`, `wizard_edit` ‚Äî wizard
- `my_page:1`, `my_close:id`, `my_del:id`, `my_rep:id` ‚Äî –∑–∞—è–≤–∫–∏

**WorkerBot:**
- `worker_consent` ‚Äî —Å–æ–≥–ª–∞—Å–∏–µ
- `job:apply:<jobId>` ‚Äî –æ—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è
- `job:hide:<jobId>` ‚Äî —Å–∫—Ä—ã—Ç—å

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| Key | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| `BOT_TOKEN_EMPLOYER` | –¢–æ–∫–µ–Ω EmployerBot |
| `BOT_TOKEN_WORKER` | –¢–æ–∫–µ–Ω WorkerBot |
| `DATABASE_URL` | PostgreSQL URL |
| `ADMIN_TELEGRAM_ID` | (–æ–ø—Ü.) –ö–æ–ø–∏—è –∑–∞—è–≤–æ–∫ –∞–¥–º–∏–Ω—É |
| `APP_TIMEZONE` | –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å (default: Asia/Tashkent) |
| `RATE_LIMIT_PER_MINUTE` | –õ–∏–º–∏—Ç —Ä–∞—Å—Å—ã–ª–∫–∏/–º–∏–Ω (default: 60) |
| `MAX_BROADCAST_PER_JOB` | –ú–∞–∫—Å. –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –Ω–∞ –∑–∞—è–≤–∫—É (default: 500) |
| `MIN_BROADCAST_BATCH_DELAY_MS` | –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ (default: 300) |
